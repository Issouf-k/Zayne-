const a6_0x4c29ef=a6_0x40eb;(function(_0x437ab1,_0x267441){const _0x545cd7=a6_0x40eb,_0x65990d=_0x437ab1();while(!![]){try{const _0x12769d=-parseInt(_0x545cd7(0x78))/0x1+parseInt(_0x545cd7(0xa4))/0x2+-parseInt(_0x545cd7(0xc3))/0x3*(-parseInt(_0x545cd7(0x85))/0x4)+-parseInt(_0x545cd7(0x91))/0x5*(-parseInt(_0x545cd7(0x98))/0x6)+parseInt(_0x545cd7(0x72))/0x7+parseInt(_0x545cd7(0xbe))/0x8+-parseInt(_0x545cd7(0xaf))/0x9*(parseInt(_0x545cd7(0xc1))/0xa);if(_0x12769d===_0x267441)break;else _0x65990d['push'](_0x65990d['shift']());}catch(_0x5bff3b){_0x65990d['push'](_0x65990d['shift']());}}}(a6_0x4fd3,0x57b78));import{downloadMediaMessage}from'baileys';import{createWriteStream,existsSync,mkdirSync,renameSync,unlink}from'fs';import{pipeline}from'stream/promises';import{join,extname}from'path';import a6_0x1fbe78 from'fs';function a6_0x40eb(_0x26264d,_0xbb5de4){const _0x4fd3ba=a6_0x4fd3();return a6_0x40eb=function(_0x40eb1a,_0x1c0aa7){_0x40eb1a=_0x40eb1a-0x72;let _0x1cdc28=_0x4fd3ba[_0x40eb1a];return _0x1cdc28;},a6_0x40eb(_0x26264d,_0xbb5de4);}import a6_0x41196a from'pino';import a6_0x25ab72 from'dotenv';import{stat}from'fs/promises';import{convertToOgg}from'./convert_to_ogg.js';const logger=a6_0x41196a({'level':process['env'][a6_0x4c29ef(0x80)]||a6_0x4c29ef(0xb9),'transport':{'target':'pino-pretty','options':{'colorize':!![],'ignore':'pid,hostname','translateTime':a6_0x4c29ef(0xa1),'includeStack':!![],'errorLikeObjectKeys':[a6_0x4c29ef(0xb4),a6_0x4c29ef(0x97)]}},'base':null,'serializers':{'error':a6_0x41196a[a6_0x4c29ef(0x95)][a6_0x4c29ef(0xb4)]}}),MIME_EXTENSIONS={'image/jpeg':a6_0x4c29ef(0x9c),'image/jpg':a6_0x4c29ef(0x9c),'image/png':a6_0x4c29ef(0x96),'image/webp':a6_0x4c29ef(0xc0),'image/gif':a6_0x4c29ef(0x7e),'video/mp4':a6_0x4c29ef(0x8a),'video/quicktime':a6_0x4c29ef(0xb5),'video/3gpp':a6_0x4c29ef(0x8b),'video/x-msvideo':'avi','audio/mpeg':a6_0x4c29ef(0xbb),'audio/ogg':a6_0x4c29ef(0x7b),'audio/aac':'aac','audio/mp4':'mp3','audio/webm':a6_0x4c29ef(0xb3),'application/pdf':a6_0x4c29ef(0x9e),'application/octet-stream':a6_0x4c29ef(0x99),'text/plain':a6_0x4c29ef(0xab)},MEDIA_EXTENSIONS={'audio':'mp3','video':a6_0x4c29ef(0x8a),'gif':a6_0x4c29ef(0x8a),'image':a6_0x4c29ef(0x9c),'sticker':a6_0x4c29ef(0xc0),'document':'bin','voice':a6_0x4c29ef(0x7b),'unknown':a6_0x4c29ef(0x99)};a6_0x25ab72[a6_0x4c29ef(0x9a)]();function a6_0x4fd3(){const _0x340615=['contextInfo','.tmp','audioMessage','34128FGmcWH','destroy','Conversion\x20terminée.','ogg','Téléchargement\x20média\x20-\x20Expéditeur:\x20','video','gif','gifPlayback','LOG_LEVEL','warn','Fichier\x20sauvegardé:\x20','Échec\x20du\x20téléchargement:\x20','size','12wgxUJO','stickerMessage','env','location','Paramètres\x20socket\x20ou\x20message_object\x20manquants','mp4','3gp','debug','sticker','downloadMediaMessage','Type\x20média\x20détecté:\x20','document','369190vWmjZR','quotedMessage','ptt','pushName','stdSerializers','png','error','18UBzXZO','bin','config','log','jpg','contactMessage','pdf','Dossier\x20créé:\x20','Erreur\x20téléchargement\x20média','HH:MM:ss','Le\x20flux\x20de\x20téléchargement\x20est\x20vide','Type\x20média:\x20','898398HdyMoE','documentMessage','stream','image','Tentative\x20de\x20téléchargement\x20sur\x20un\x20message\x20non\x20média','Timeout\x20du\x20téléchargement:\x20',',\x20Extension:\x20','txt','imageMessage','close','abort','10505673OgMHby','unknown','extendedTextMessage','Conversion\x20\x20en\x20OGG...','webm','err','mov','MEDIA_PATH','key','mimetype','info','fileName','mp3','contact','audio','2509152RFQOmz','function','webp','10dyEvFH','locationMessage','183369DKgQxO','Timeout\x20du\x20téléchargement\x20après\x20','videoMessage','inconnu','Nettoyage\x20fichier\x20temporaire\x20échoué:\x20','Média\x20sauvegardé:\x20','Impossible\x20de\x20récupérer\x20la\x20taille\x20du\x20fichier:\x20','message','2750909fkuEeo','signal','updateMediaMessage'];a6_0x4fd3=function(){return _0x340615;};return a6_0x4fd3();}const mediaDir=process[a6_0x4c29ef(0x87)][a6_0x4c29ef(0xb6)]||'./media',DOWNLOAD_TIMEOUT=parseInt(process['env']['DOWNLOAD_TIMEOUT'])||0xea60;async function downloader_media(_0x173cb2,_0x2bfeae,_0x35ee17){const _0x504efc=a6_0x4c29ef;let _0xddf8d8=null,_0x8b573=null;try{if(!_0x173cb2||!_0x2bfeae)throw new Error(_0x504efc(0x89));if(!isMediaMessage(_0x2bfeae))return logger['warn'](_0x504efc(0xa8)),null;!existsSync(mediaDir)&&(mkdirSync(mediaDir,{'recursive':!![]}),logger['debug'](_0x504efc(0x9f)+mediaDir));logger[_0x504efc(0xb9)](_0x504efc(0x7c)+(_0x2bfeae[_0x504efc(0x94)]||_0x504efc(0xc6)));const {fileExt:_0xf4dde7,mediaType:_0x1e27c8}=getNormalizedMediaInfo(_0x2bfeae);if(_0x1e27c8==='contact'||_0x1e27c8===_0x504efc(0x88))return logger['warn']('Type\x20de\x20média\x20non\x20téléchargeable:\x20'+_0x1e27c8),null;const _0xc31ffc=generateFilename(_0x35ee17,_0x1e27c8,_0xf4dde7),_0x590246=join(mediaDir,_0xc31ffc);_0xddf8d8=_0x590246+_0x504efc(0x76);const _0x500723=new AbortController(),_0x12e643=setTimeout(()=>{const _0x30e394=_0x504efc;_0x500723[_0x30e394(0xae)](),logger[_0x30e394(0x81)](_0x30e394(0xc4)+DOWNLOAD_TIMEOUT+'ms');},DOWNLOAD_TIMEOUT);try{_0x8b573=await downloadMediaMessage(_0x2bfeae,_0x504efc(0xa6),{'timeout':DOWNLOAD_TIMEOUT,'signal':_0x500723[_0x504efc(0x73)]},{'reuploadRequest':_0x173cb2[_0x504efc(0x74)],'logger':logger['child']({'module':_0x504efc(0x8e)})});if(!_0x8b573)throw new Error(_0x504efc(0xa2));return await pipeline(_0x8b573,createWriteStream(_0xddf8d8)),clearTimeout(_0x12e643),renameSync(_0xddf8d8,_0x590246),_0x1e27c8==='audio'&&(logger[_0x504efc(0xb9)](_0x504efc(0xb2)),await convertToOgg(_0x590246),logger[_0x504efc(0xb9)](_0x504efc(0x7a))),console[_0x504efc(0x9b)](_0x504efc(0x82)+_0x590246),logger[_0x504efc(0xb9)](_0x504efc(0xc8)+_0xc31ffc+'\x20('+_0x1e27c8+')'),{'chemin':_0xc31ffc,'type':_0x1e27c8,'fullPath':_0x590246};}catch(_0x57f050){clearTimeout(_0x12e643);if(_0x500723[_0x504efc(0x73)]['aborted'])throw new Error(_0x504efc(0xa9)+DOWNLOAD_TIMEOUT+'ms\x20dépassé');throw _0x57f050;}}catch(_0x2927ee){logger['error']({'err':_0x2927ee,'msg':_0x504efc(0xa0),'messageId':_0x2bfeae?.[_0x504efc(0xb7)]?.['id'],'mediaType':_0x2bfeae?getMediaType(_0x2bfeae):_0x504efc(0xc6)},_0x504efc(0x83)+_0x2927ee[_0x504efc(0xca)]);if(_0xddf8d8&&existsSync(_0xddf8d8))try{await unlink(_0xddf8d8);}catch(_0x214c05){logger[_0x504efc(0x81)](_0x504efc(0xc7)+_0x214c05[_0x504efc(0xca)]);}throw new Error(_0x504efc(0x83)+_0x2927ee[_0x504efc(0xca)]);}finally{if(_0x8b573)try{if(typeof _0x8b573[_0x504efc(0x79)]===_0x504efc(0xbf))_0x8b573[_0x504efc(0x79)]();else{if(typeof _0x8b573['close']===_0x504efc(0xbf))_0x8b573[_0x504efc(0xad)]();else typeof _0x8b573[_0x504efc(0xae)]===_0x504efc(0xbf)&&_0x8b573[_0x504efc(0xae)]();}}catch(_0x5be5a8){logger['warn']('Erreur\x20lors\x20de\x20la\x20fermeture\x20du\x20stream:\x20'+_0x5be5a8[_0x504efc(0xca)]);}}}function getNormalizedMediaInfo(_0xdb0951){const _0x3d32b1=a6_0x4c29ef,{mediaType:_0x2e8ddd,mimeType:_0x2e2342,fileName:_0x51cfa7}=getMediaInfo(_0xdb0951);let _0x5c1dea=MIME_EXTENSIONS[_0x2e2342]||MEDIA_EXTENSIONS[_0x2e8ddd]||_0x3d32b1(0x99);return logger[_0x3d32b1(0x8c)](_0x3d32b1(0xa3)+_0x2e8ddd+',\x20MIME:\x20'+_0x2e2342+_0x3d32b1(0xaa)+_0x5c1dea),{'fileExt':_0x5c1dea,'mediaType':_0x2e8ddd,'mimeType':_0x2e2342};}function isMediaMessage(_0x15c153){const _0x13a96e=a6_0x4c29ef;if(!_0x15c153||!_0x15c153[_0x13a96e(0xca)])return![];const _0x4aaf9a=_0x15c153[_0x13a96e(0xca)];return Boolean(_0x4aaf9a[_0x13a96e(0xac)]||_0x4aaf9a[_0x13a96e(0xc5)]||_0x4aaf9a['audioMessage']||_0x4aaf9a[_0x13a96e(0xa5)]||_0x4aaf9a[_0x13a96e(0x86)]||_0x4aaf9a[_0x13a96e(0x9d)]||_0x4aaf9a[_0x13a96e(0xc2)]||_0x4aaf9a[_0x13a96e(0xb1)]?.['contextInfo']?.[_0x13a96e(0x92)]&&isMediaMessage({'message':_0x4aaf9a[_0x13a96e(0xb1)][_0x13a96e(0x75)][_0x13a96e(0x92)]}));}function getMediaInfo(_0x249d5e){const _0x4da2c2=a6_0x4c29ef;if(!_0x249d5e||!_0x249d5e[_0x4da2c2(0xca)])return{'mediaType':_0x4da2c2(0xb0),'mimeType':'','fileName':''};const _0x21ac1d=_0x249d5e[_0x4da2c2(0xca)];let _0x4013b2=_0x4da2c2(0xb0),_0x3ab728='',_0xb94268='';if(_0x21ac1d[_0x4da2c2(0xac)])_0x4013b2='image',_0x3ab728=_0x21ac1d[_0x4da2c2(0xac)][_0x4da2c2(0xb8)];else{if(_0x21ac1d['videoMessage'])_0x4013b2=_0x21ac1d[_0x4da2c2(0xc5)][_0x4da2c2(0x7f)]?_0x4da2c2(0x7e):_0x4da2c2(0x7d),_0x3ab728=_0x21ac1d['videoMessage']['mimetype'];else{if(_0x21ac1d[_0x4da2c2(0x77)])_0x4013b2=_0x21ac1d[_0x4da2c2(0x77)][_0x4da2c2(0x93)]?_0x4da2c2(0xbd):_0x4da2c2(0xbd),_0x3ab728=_0x21ac1d[_0x4da2c2(0x77)][_0x4da2c2(0xb8)];else{if(_0x21ac1d[_0x4da2c2(0xa5)])_0x4013b2=_0x4da2c2(0x90),_0x3ab728=_0x21ac1d[_0x4da2c2(0xa5)][_0x4da2c2(0xb8)],_0xb94268=_0x21ac1d[_0x4da2c2(0xa5)][_0x4da2c2(0xba)];else{if(_0x21ac1d[_0x4da2c2(0x86)])_0x4013b2=_0x4da2c2(0x8d),_0x3ab728=_0x21ac1d['stickerMessage']['mimetype'];else{if(_0x21ac1d[_0x4da2c2(0x9d)])_0x4013b2='contact';else{if(_0x21ac1d[_0x4da2c2(0xc2)])_0x4013b2=_0x4da2c2(0x88);else{if(_0x21ac1d[_0x4da2c2(0xb1)]?.[_0x4da2c2(0x75)]?.[_0x4da2c2(0x92)])return getMediaInfo({'message':_0x21ac1d[_0x4da2c2(0xb1)]['contextInfo'][_0x4da2c2(0x92)]});}}}}}}}return logger[_0x4da2c2(0x8c)](_0x4da2c2(0x8f)+_0x4013b2+',\x20MIME:\x20'+_0x3ab728),{'mediaType':_0x4013b2,'mimeType':_0x3ab728,'fileName':_0xb94268};}function generateFilename(_0x50e4c5,_0x2a32b5,_0x1cc807){return _0x50e4c5+'_'+_0x2a32b5+'.'+_0x1cc807;}async function getFileSize(_0x5c9387){const _0x4d8fe3=a6_0x4c29ef;try{const _0x274338=await stat(_0x5c9387);return _0x274338[_0x4d8fe3(0x84)];}catch(_0x2b419e){return logger['warn'](_0x4d8fe3(0xc9)+_0x2b419e[_0x4d8fe3(0xca)]),0x0;}}function getMediaType(_0x2c4990){const _0x39727e=a6_0x4c29ef;if(!_0x2c4990||!_0x2c4990[_0x39727e(0xca)])return _0x39727e(0xb0);const _0x190f2d=_0x2c4990['message'];if(_0x190f2d['imageMessage'])return _0x39727e(0xa7);if(_0x190f2d[_0x39727e(0xc5)])return _0x190f2d[_0x39727e(0xc5)][_0x39727e(0x7f)]?'gif':_0x39727e(0x7d);if(_0x190f2d[_0x39727e(0x77)])return _0x190f2d['audioMessage']['ptt']?'audio':_0x39727e(0xbd);if(_0x190f2d[_0x39727e(0xa5)])return'document';if(_0x190f2d[_0x39727e(0x86)])return _0x39727e(0x8d);if(_0x190f2d[_0x39727e(0x9d)])return _0x39727e(0xbc);if(_0x190f2d[_0x39727e(0xc2)])return'location';return _0x39727e(0xb0);}export default downloader_media;